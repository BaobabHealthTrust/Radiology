<%= javascript_include_tag "jquery" %>
<%= javascript_include_tag 'utils' %>
<style>

.tt_controls_summary #clearButton { display: none; }

.tt_controls_summary .inputFrameClass { height: 448px; }

#tt_page_summary .inputFrameClass { height: 448px; }

.selected_conditions {
  font-size: 25px;
  padding-left: 5px;
  font-weight: bold;
}
</style>

<%
    patient = PatientService.get_patient(Person.find(@patient.id))
    session_date = session[:datetime].to_date.strftime('%d/%m/%Y') rescue Date.today.strftime('%d/%m/%Y')

   
%>

<script>
  var tt_cancel_destination = "/patients/show/<%= @patient.patient_id -%>";
  var referred_by = null;

  function summary() {

    var line2 = "<%=patient.national_id%> ";
    line2 += "(<%=patient.sex.first%>)";
    line2 += " <%=patient.birth_date%>";

    var line3 = $("list_of_radiology_test").value;
    if($("detailed_examination").value !="")
     {
        var line3 = line3 + " - " + $("detailed_examination").value
     }
    else
     {
       var line3 = line3 + " - " + $("examination").value
     }
    
    var referred_from =  referred_by;

    var line4 = "<%= session_date %>, " + referred_from;
    $('inputFrame'+tstCurrentPage).innerHTML += '<div class="selected_conditions"><br />' + "<%=patient.name%>" + '</div>' ;
    $('inputFrame'+tstCurrentPage).innerHTML += '<div class="selected_conditions"><br />' + line2 + '</div>' ;
    $('inputFrame'+tstCurrentPage).innerHTML += '<div class="selected_conditions"><br />' + line3 + '</div>' ;
    $('inputFrame'+tstCurrentPage).innerHTML += '<div class="selected_conditions"><br />' + line4 + '</div>' ;

  }

  function setReferredBy() {
    referred_by = $('touchscreenInput'+tstCurrentPage).value;
  }
  
  function set_ajaxURL_for_suggestions(value) {
  	url = "/investigation/examination?examination_type=" + value,
    $('touchscreenInput'+tstCurrentPage).setAttribute('ajaxURL', url);
    listSuggestions(tstCurrentPage);
  }

  examination_sets = '<%= "#{@examination_sets}" %>';
</script>
<%# @wards.each do |ward|
     wards+="<option value=#{ward[1]}>#{ward[0]}</option>"
   end %>
<% form_tag "/orders/create", :method => :post do %>

<%= hidden_field_tag "encounter[encounter_type_name]", "RADIOLOGY EXAMINATION" %>
<%= hidden_field_tag "encounter[patient_id]", @patient.id %>
<%= hidden_field_tag "encounter[encounter_datetime]", DateTime.now() %>
<%= hidden_field_tag "encounter[provider_id]", current_user.user_id %>

<%= hidden_field_tag  :examination_number, @next_exam_number %>

<%= touch_select_tag "RADIOLOGY TEST", @patient, concept_set_options("LIST OF RADIOLOGY TESTS"),
		{	:id => "list_of_radiology_test",
		 	:helpText => "Please select the type of examination" } %>


<%= touch_select_tag "Examination", @patient, nil,
		{	:id => "examination",
			:tt_onLoad => 'set_ajaxURL_for_suggestions(document.getElementById("list_of_radiology_test").value);',
		 	:helpText => "Please select the examination" } %>

<%= touch_select_tag "Detailed examination", @patient, nil,
		{	:id => "detailed_examination",
		 	:condition => 'examination_sets.contains($("examination").value)',
                        :tt_onLoad => 'set_ajaxURL_for_suggestions(document.getElementById("examination").value);',
		 	:helpText => "Please select the detailed examination" } %>


<%= touch_select_tag "REFERRED FROM", @patient, options_for_select(@referral_locations),
                     {:id => "referred_by",
                      :helpText => "Referred from",
                      :tt_pageStyleClass => "NoKeyboard NoInput small",
                      :tt_onUnLoad => "setReferredBy();"} %>

<%= touch_yes_no_tag "PAYING", @patient, nil,
                     {:id => "paying",
                      :helpText => "Is this a paying patient?",
                      :tt_pageStyleClass => "NoKeyboard NoInput small" } %>

<%= touch_select_tag "PAYMENT TYPE", @patient, concept_set_options("PAYMENT TYPE"),
                     {:id => "payment_type",
                      :helpText => "Select payment method",
                      :condition => '$("paying").value == "YES"',
                      :tt_pageStyleClass => "NoKeyboard NoInput small" } %>

<%= touch_text_field_tag 'RECEIPT NUMBER',@patient , nil,
                         {:id => "receipt_number",
                          :helpText=> "Enter receipt number" ,
                          :condition => '$("payment_type").value == "Cash"'} %>

<%= touch_text_field_tag 'INVOICE NUMBER',@patient , nil,
                         {:id => "receipt_number",
                          :helpText=> "Enter invoice number" ,
                          :condition => '$("payment_type").value == "Invoice"'} %>

<%= touch_numeric_tag 'PAYMENT AMOUNT',@patient , nil,
                         {:id => "payment_amount",
                          :field_type => "number",
                          :helpText=> "Enter payment amount" ,
                          :validationRule => "([0-9]+\\.[0-9])|Unknown$",
		          :validationMessage => "You must enter a decimal number",
                          :tt_pageStyleClass => "Numeric NumbersOnlyWithDecimal",
                          :condition => '$("paying").value == "YES"'} %>

<label for='summary'>Summary</label>
<%= text_field_tag :summary, nil,
                  { :tt_onLoad => "summary();",
                    :optional => "true",
                    :tt_pageStyleClass => "NoControls" } %>

<%end%>

